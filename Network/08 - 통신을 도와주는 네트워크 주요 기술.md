# 통신을 도와주는 네트워크 주요 기술

<br>

## NAT/PAT
```text
NAT (Network Address Translation, 네트워크 주소 변환)

NAT는 기본적으로 하나의 네트워크 주소에 다른 하나의 네트워크 주소로 변환하는 1:1 변환이 기본
하지만 IP 주소가 고갈되는 문제를 해결하기 위해 1:1 변환이 아닌 여러 개의 IP를 하나의 IP로 변환하기도 한다. (PAT, NAPT)

NAT와 PAT는 다양한 곳에서 사용되고 있다.

1. IPv4 주소 고갈문제의 솔루션으로 NAT가 사용

2. 보안을 강화하는데 NAT를 사용
 - 외부와 통신할 때 내부 IP를 다른 IP로 변환해 통신하며 외부에 사내 IP 주소 체계를 숨길 수 있다
 
3. IP 주소 체계가 같은 두 개의 네트워크 간 통신을 가능하게 해준다
 
4. 불필요한 설정 변경을 줄일 수 있다
```

### NAT 동작 방식
```text
1. 사용자는 웹 서버에 접근하기 위해 출발지 IP를 10.10.10.10으로, 목적지 IP와 서비스 포트는 20.20.20.20과 80으로 패킷을 전송
   출발지 서비스 포트는 임의의 포트로 할당

2. NAT 역할을 수행하는 장비에서는 사용자가 보낸 패킷을 수신한 후 NAT 정책에 따라 외부 네트워크와 통신이 가능한 공인 IP인 11.11.11.11로 IP 주소를 변경
   NAT 장비에서 변경 전후의 IP 주소를 NAT 테이블에 저장

3. NAT 장비에서는 출발지 주소를 11.11.11.11로 변경해 목적지 웹 서버로 전송

4. 패킷을 수신한 웹 서버는 사용자에게 응답을 보낸다

5. 웹 서버로부터 응답 패킷을 수신한 NAT 장비는 자신의 NAT 테이블에서 목적지 IP에 대한 원래 패킷을 발생시킨 IP 주소가 10.10.10.10인 것을 확인

6. NAT 변환 테이블에서 확인된 원래 패킷 출발지 IP(10.10.10.10)로 변경해 사용자에게 전송
```

### PAT 동작 방식
```text
1. 사용자는 웹 서버에 접근하기 위해 출발지 IP를 10.10.10.10으로, 목적지 IP와 서비스 포트는 20.20.20.20과 80으로 패킷을 전송
   출발지 서비스 포트는 임의의 포트(2000번)로 할당
   
2. NAT 장비는 사용자가 보낸 패킷을 받아 외부 네트워크와 통신이 가능한 공인 IP인 11.11.11.11로 변경
   다만 출발지에 있는 다수의 사용자가 동일한 공인 IP로 변환되어야 하므로 출발지의 서비스 포트도 변경
   이 변경 정보를 NAT 테이블에 기록
   
3. NAT 장비에서 변경된 출발지 IP 주소인 11.11.11.11과 서비스 포트(3000번)로 패킷을 재작성해 웹 서버로 다시 전송

4. 사용자가 보낸 패킷을 수신한 웹 서버는 사용자에게 패킷을 응답
   출발지 IP는 웹 서버의 IP 주소인 20.20.20.20으로 채워지고 목적지 IP는 NAT 장비에 의해 변환된 공인 IP 11.11.11.11과 서비스 포트로 채워져 전송
   
5. 웹 서버로부터 응답 패킷을 수신한 NAT 장비는 NAT 테이블을 확인해 웹 서버로부터 받은 패킷의 목적지 IP 주소인 11.11.11.11이
   원래 10.10.10.10이며 서비스 포트 3000이 원래 2000인것을 확인
   
6. NAT 장비는 NAT 테이블에서 확인한 목적지 IP 주소와 서비스 포트로 패킷을 재작성한 후 사용자에게 전달


PAT 동작 방식은 NAT와 거의 동일하지만 IP 주소와 서비스 포트를 함께 변경해 NAT 테이블을 관리하므로 하나의 IP만으로
다양한 포트 번호를 사용해 사용자를 구분할 수 있다.

하지만 서비스 포트의 개수는 제한되어 있어 재사용된다.
만약 서비스 포트가 모두 사용중이거나 재사용 할 수 없을때는 PAT는 정상적으로 동작하지 않는다
```

<br>

### SNAT
```text
SNAT (Source NAT. 출발지 주소를 변경하는 NAT)

SNAT는 사설에서 공인으로 통신할 때 많이 사용
공인 IP 주소의 목적지에서 출발지로 다시 응답을 받으려면 출발지 IP 주소 경로가 필요한데 공인 대역에서는 사설 대역으로의 경로를 알 수 없으므로 
공인 IP의 목적지로 서비스를 요청할 때 출발지에서는 사설 IP를 별도의 공인 IP로 NAT해 서비스를 요청해야 한다.
그래야 해당 요청을 받은 목적지에서 출발지 IP를 공인 IP로 확인해 다시 응답할 수 있는 경로를 찾을 수 있다.

다른 경우는 보안상 SNAT를 사용
회사에서 다른 대외사와 통신 시 내부 IP 주소가 아니라 별도의 다른 IP로 전환해 전송함으로써 대외에 내부의 실제 IP 주소를 숨길 수 있다.

로드 밸런서의 구성에 따라 SNAT를 사용
출발지와 목적지 서버가 동일한 대역일 때는 로드 밸런서 구성에 따라 트래픽이 로드 밸런서를 거치지 않고 응답할 수 있어 
SNAT를 통해 응답 트래픽이 로드 밸런서를 거치게 할 수 있다.
```

### DNAT
```text
DNAT는 로드밸런서에서 많이 사용
사용자는 서비스 요청을 위해 로드 밸런서에 설정된 서비스 Virtual IP 로 서비스를 요청하고
로드 밸런서에서는 서비스 Virtual IP 를 서버의 실제 IP로 DNAT해 보낸다.
```

<br>

## DNS
```text



























