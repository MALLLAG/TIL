# 동시성이 필요한 이유

### 동시성은 결합을 없애는 전략이다
- 무엇과 언제를 분리하는 전략 (스레드가 하나인 프로그램은 무엇과 언제가 밀접)
- 무엇과 언제를 분리하며 애플리케이션 구조와 효율이 좋아진다

### 동시성의 특징
- 동시성은 대기 시간이 아주 길어 여러 스레드가 프로세서를 공유할 수 있거나, 여러 프로세서가 동시에 처리할 독립적인 계산이 충분히 많은 경우에만 성능이 높아진다
- 동시성을 구현하면 설계가 달라진다
- 동시 수정, 데드락같은 상황을 피할 수 있어야 한다
- 동시성은 부하를 유발한다
- 동시성은 복잡하다

<br>

# 동시성 코드가 일으키는 문제를 방어하는 원칙과 기술

### 단일 책임 원칙(SRP)
- 동시성 관련 코드는 다른 코드와 분리해야 한다

### 따름 정리
- 공유 객체를 사용하는 코드 내 임계영역을 synchronized로 보호해야 한다
- 자료를 캡슐화하고, 공유자료를 최대한 줄여라 ex) 객체를 복사해 읽기 전용으로 사용
- 모든 정보는 비공유 출처에서 가져오고, 로컬 변수에 저장한다

### 스레드 환경에 안전한 컬렉션
- java.util.concurrent 패키지가 제공하는 클래스는 다중 스레드 환경에서 안전하고, 성능이 좋다

<br>

# 동기화하는 메서드 사이에 존재하는 의존성을 이해하라
- 동기화하는 메서드 사이에 의존성이 존재하면 동시성 코드에 찾아내기 어려운 버그가 생긴다

### 공유 객체 하나에 여러 메서드가 필요하다면
- 클라이언트가 첫 메서드를 부르기 이전부터 마지막 메서드를 호출할 때까지 서버를 잠근다
- 서버 내에서 서버를 잠그고 모든 동작을 수행한 후 클라이언트에게는 잠금을 해제하는 메서드르 제공
- 잠금을 수행하는 중계자를 작성

<br>

# 동기화하는 부분을 작게 만들어라
- 자바에서 synchronized 키워드를 사용하면 락을 설정, 같은 락으로 감싼 모든 코드 영역은 한 번에 한 스레드만 실행이 가능 (락은 스레드를 지연시키고 부하를 가중)
- 그러므로 여기저기 synchronized를 남발하면 안된다

<br>

# 스레드 코드 테스트
- 코드가 올바르다고 증명하기는 불가능하다
- 문제를 노출하는 테스트 케이스르 작성해라
- 말이 안 되는 실패는 잠정적인 스레드 문제로 취급하라
- 다중 스레드를 고려하지 않은 순차 코드부터 제대로 돌게 만들자










