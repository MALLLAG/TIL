# 프록시

**JPA는 엔티티가 실제 사용될 때까지 DB 조회를 지연하는 지연 로딩을 사용한다.**

지연 로딩 기능을 사용하려면 실제 엔티티 객체 대신 DB 조회를 지연할 수 있는 가짜 객체가 필요한데, 이를 프록시 객체라고 한다.

<br>

## 프록시 기초

엔티티를 실제 사용하는 시점까지 DB 조회를 미루고 싶으면 em.getReference() 메서드를 사용하면 된다. <br>
이 메서드를 호출할 땐 DB를 조회하지 않고, DB 접근을 위임한 프록시 객체를 반환한다.

### 프록시의 특징

- 프록시 클래스는 실제 클래스를 상속 받아서 만들어진다.
- 프록시 객체는 실제 객체에 대한 참조를 보관하고, 프록시 객체의 메서드를 호출하면 프록시 객체는 실제 객체의 메서드를 호출한다.
- 프록시 객체는 처음 한 번만 초기화된다.
- 프록시 객체가 초기화되어도 프록시 객체가 실제 엔티티로 바뀌는 것이 아니고, 프록시 객체를 통해서 실제 엔티티에 접근한다.
- 영속성 컨텍스트에 엔티티가 존재하면, em.getReference()를 호출해도 실제 엔티티가 반환된다.
- 초기화는 영속성 컨텍스트의 도움을 받아야 하므로, 준영속 상태의 프록시를 초기화하면 예외가 발생한다.

### 프록시 객체의 초기화

프록시 객체는 member.getName()처럼 실제 사용될 때 DB를 조회해 실제 엔티티 객체를 생성한다.

<img src="img/4.png" width=500 />

<br>

## 프록시와 식별자 

엔티티를 프록시로 조회할 때 식별자 값을 파라미터로 전달하는데, 프록시 객체는 이 식별자 값을 보관한다. <br>
그래서 식별자 값을 조회할때는 프록시를 초기화하지 않는다.

<br>
<hr>

# 즉시 로딩과 지연 로딩














